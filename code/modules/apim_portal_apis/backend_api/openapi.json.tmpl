{
  "swagger": "2.0",
  "info": {
    "title": "CGN Onboarding Portal",
    "description": "Carta Giovani Nazionale Onboarding Portal",
    "version": "0.0.1"
  },
  "host": "${host}",
  "schemes": [
    "https"
  ],
  "tags": [
    {
      "name": "agreement",
      "description": "Agreement"
    },
    {
      "name": "profile",
      "description": "Profile"
    },
    {
      "name": "discount",
      "description": "Discount"
    }
  ],
  "paths": {
    "/agreements": {
      "post": {
        "tags": [
          "agreement"
        ],
        "summary": "Create a agreement",
        "operationId": "createAgreement",
        "responses": {
          "200": {
            "description": "Agreement",
            "schema": {
              "$ref": "#/definitions/Agreement"
            }
          },
          "403": {
            "$ref": "#/responses/Forbidden"
          }
        }
      }
    },
    "/agreements/{agreementId}/approval": {
      "post": {
        "tags": [
          "agreement"
        ],
        "summary": "Request approval",
        "operationId": "requestApproval",
        "parameters": [
          {
            "$ref": "#/parameters/AgreementId"
          }
        ],
        "responses": {
          "204": {
            "description": "Agreement approval requested"
          },
          "400": {
            "$ref": "#/responses/InvalidRequest"
          },
          "403": {
            "$ref": "#/responses/Forbidden"
          },
          "404": {
            "$ref": "#/responses/NotFound"
          }
        }
      }
    },
    "/agreements/{agreementId}/profile": {
      "post": {
        "tags": [
          "profile"
        ],
        "summary": "Create a profile",
        "operationId": "createProfile",
        "parameters": [
          {
            "$ref": "#/parameters/AgreementId"
          },
          {
            "in": "body",
            "description": "Profile to create",
            "name": "profile",
            "required": true,
            "schema": {
              "$ref": "#/definitions/CreateProfile"
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Profile created",
            "schema": {
              "$ref": "#/definitions/Profile"
            }
          },
          "400": {
            "$ref": "#/responses/InvalidRequest"
          },
          "403": {
            "$ref": "#/responses/Forbidden"
          },
          "404": {
            "$ref": "#/responses/NotFound"
          }
        }
      },
      "get": {
        "tags": [
          "profile"
        ],
        "summary": "Get a profile",
        "operationId": "getProfile",
        "parameters": [
          {
            "$ref": "#/parameters/AgreementId"
          }
        ],
        "responses": {
          "200": {
            "description": "Profile",
            "schema": {
              "$ref": "#/definitions/Profile"
            }
          },
          "403": {
            "$ref": "#/responses/Forbidden"
          },
          "404": {
            "$ref": "#/responses/NotFound"
          }
        }
      },
      "put": {
        "tags": [
          "profile"
        ],
        "summary": "Update a profile",
        "operationId": "updateProfile",
        "parameters": [
          {
            "in": "body",
            "description": "Profile to update",
            "name": "profile",
            "required": true,
            "schema": {
              "$ref": "#/definitions/UpdateProfile"
            }
          },
          {
            "$ref": "#/parameters/AgreementId"
          }
        ],
        "responses": {
          "200": {
            "description": "Profile updated",
            "schema": {
              "$ref": "#/definitions/Profile"
            }
          },
          "400": {
            "$ref": "#/responses/InvalidRequest"
          },
          "403": {
            "$ref": "#/responses/Forbidden"
          },
          "404": {
            "$ref": "#/responses/NotFound"
          }
        }
      }
    },
    "/agreements/{agreementId}/discounts": {
      "get": {
        "tags": [
          "discount"
        ],
        "summary": "Get list of discounts",
        "operationId": "getDiscounts",
        "parameters": [
          {
            "$ref": "#/parameters/AgreementId"
          }
        ],
        "responses": {
          "200": {
            "description": "List of discounts",
            "schema": {
              "$ref": "#/definitions/Discounts"
            }
          },
          "403": {
            "$ref": "#/responses/Forbidden"
          },
          "404": {
            "$ref": "#/responses/NotFound"
          }
        }
      },
      "post": {
        "tags": [
          "discount"
        ],
        "summary": "Create a discount",
        "operationId": "createDiscount",
        "parameters": [
          {
            "$ref": "#/parameters/AgreementId"
          },
          {
            "in": "body",
            "description": "Discount to create",
            "name": "discount",
            "required": true,
            "schema": {
              "$ref": "#/definitions/CreateDiscount"
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Discount created",
            "schema": {
              "$ref": "#/definitions/Discount"
            }
          },
          "400": {
            "$ref": "#/responses/InvalidRequest"
          },
          "403": {
            "$ref": "#/responses/Forbidden"
          },
          "404": {
            "$ref": "#/responses/NotFound"
          }
        }
      }
    },
    "/agreements/{agreementId}/discounts/{discountId}": {
      "put": {
        "tags": [
          "discount"
        ],
        "summary": "Update a discount",
        "operationId": "updateDiscount",
        "parameters": [
          {
            "$ref": "#/parameters/AgreementId"
          },
          {
            "$ref": "#/parameters/DiscountId"
          },
          {
            "in": "body",
            "description": "Discount to update",
            "name": "discount",
            "required": true,
            "schema": {
              "$ref": "#/definitions/UpdateDiscount"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Discount updated",
            "schema": {
              "$ref": "#/definitions/Discount"
            }
          },
          "400": {
            "$ref": "#/responses/InvalidRequest"
          },
          "403": {
            "$ref": "#/responses/Forbidden"
          },
          "404": {
            "$ref": "#/responses/NotFound"
          }
        }
      },
      "delete": {
        "tags": [
          "discount"
        ],
        "summary": "Delete a discount",
        "operationId": "deleteDiscount",
        "parameters": [
          {
            "$ref": "#/parameters/AgreementId"
          },
          {
            "$ref": "#/parameters/DiscountId"
          }
        ],
        "responses": {
          "204": {
            "description": "Discount deleted"
          },
          "403": {
            "$ref": "#/responses/Forbidden"
          },
          "404": {
            "$ref": "#/responses/NotFound"
          }
        }
      }
    }
  },
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "parameters": {
    "AgreementId": {
      "name": "agreementId",
      "in": "path",
      "description": "Agreement id",
      "required": true,
      "type": "string"
    },
    "DiscountId": {
      "name": "discountId",
      "in": "path",
      "description": "Discount id",
      "required": true,
      "type": "string"
    }
  },
  "definitions": {
    "Agreement": {
      "type": "object",
      "discriminator": "state",
      "required": [
        "id",
        "state"
      ],
      "properties": {
        "id": {
          "type": "string"
        },
        "state": {
          "$ref": "#/definitions/AgreementState"
        },
        "profileLastModifiedDate": {
          "type": "string",
          "format": "date"
        },
        "discountsLastModifiedDate": {
          "type": "string",
          "format": "date"
        },
        "documentsLastModifiedDate": {
          "type": "string",
          "format": "date"
        }
      }
    },
    "DraftAgreement": {
      "allOf": [
        {
          "$ref": "#/definitions/Agreement"
        },
        {
          "type": "object"
        }
      ]
    },
    "PendingAgreement": {
      "allOf": [
        {
          "$ref": "#/definitions/Agreement"
        },
        {
          "type": "object"
        }
      ]
    },
    "ApprovedAgreement": {
      "allOf": [
        {
          "$ref": "#/definitions/Agreement"
        },
        {
          "type": "object",
          "required": [
            "startDate",
            "endDate"
          ],
          "properties": {
            "startDate": {
              "type": "string",
              "format": "date"
            },
            "endDate": {
              "type": "string",
              "format": "date"
            }
          }
        }
      ]
    },
    "RejectedAgreement": {
      "allOf": [
        {
          "$ref": "#/definitions/Agreement"
        },
        {
          "type": "object"
        }
      ]
    },
    "AgreementState": {
      "type": "string",
      "enum": [
        "DraftAgreement",
        "PendingAgreement",
        "ApprovedAgreement",
        "RejectedAgreement"
      ]
    },
    "CreateProfile": {
      "type": "object",
      "required": [
        "fullName",
        "name",
        "pecAddress",
        "referent",
        "description",
        "salesChannel"
      ],
      "properties": {
        "fullName": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "pecAddress": {
          "type": "string",
          "format": "email"
        },
        "referent": {
          "$ref": "#/definitions/CreateReferent"
        },
        "description": {
          "type": "string"
        },
        "salesChannel": {
          "$ref": "#/definitions/SalesChannel"
        }
      }
    },
    "UpdateProfile": {
      "type": "object",
      "required": [
        "name",
        "pecAddress",
        "referent",
        "description",
        "salesChannel"
      ],
      "properties": {
        "name": {
          "type": "string"
        },
        "pecAddress": {
          "type": "string",
          "format": "email"
        },
        "referent": {
          "$ref": "#/definitions/UpdateReferent"
        },
        "description": {
          "type": "string"
        },
        "salesChannel": {
          "$ref": "#/definitions/SalesChannel"
        }
      }
    },
    "Profile": {
      "type": "object",
      "required": [
        "id",
        "agreementId",
        "fullName",
        "name",
        "taxCodeOrVat",
        "pecAddress",
        "referent",
        "description",
        "salesChannel"
      ],
      "properties": {
        "id": {
          "type": "string"
        },
        "agreementId": {
          "type": "string"
        },
        "fullName": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "taxCodeOrVat": {
          "type": "string"
        },
        "pecAddress": {
          "type": "string",
          "format": "email"
        },
        "referent": {
          "$ref": "#/definitions/Referent"
        },
        "description": {
          "type": "string"
        },
        "salesChannel": {
          "$ref": "#/definitions/SalesChannel"
        }
      }
    },
    "Referent": {
      "type": "object",
      "required": [
        "firstName",
        "lastName",
        "emailAddress",
        "telephoneNumber"
      ],
      "properties": {
        "firstName": {
          "type": "string"
        },
        "lastName": {
          "type": "string"
        },
        "emailAddress": {
          "type": "string"
        },
        "telephoneNumber": {
          "type": "string",
          "maxLength": 15
        }
      }
    },
    "SalesChannel": {
      "type": "object",
      "discriminator": "channelType",
      "required": [
        "channelType"
      ],
      "properties": {
        "channelType": {
          "$ref": "#/definitions/SalesChannelType"
        }
      }
    },
    "OnlineChannel": {
      "allOf": [
        {
          "$ref": "#/definitions/SalesChannel"
        },
        {
          "type": "object",
          "required": [
            "websiteUrl"
          ],
          "properties": {
            "websiteUrl": {
              "type": "string"
            }
          }
        }
      ]
    },
    "OfflineChannel": {
      "allOf": [
        {
          "$ref": "#/definitions/SalesChannel"
        },
        {
          "type": "object",
          "required": [
            "addresses"
          ],
          "properties": {
            "websiteUrl": {
              "type": "string"
            },
            "addresses": {
              "type": "array",
              "minItems": 1,
              "items": {
                "$ref": "#/definitions/Address"
              }
            }
          }
        }
      ]
    },
    "BothChannels": {
      "allOf": [
        {
          "$ref": "#/definitions/SalesChannel"
        },
        {
          "type": "object",
          "required": [
            "websiteUrl",
            "addresses"
          ],
          "properties": {
            "websiteUrl": {
              "type": "string"
            },
            "addresses": {
              "type": "array",
              "minItems": 1,
              "items": {
                "$ref": "#/definitions/Address"
              }
            }
          }
        }
      ]
    },
    "SalesChannelType": {
      "type": "string",
      "enum": [
        "OnlineChannel",
        "OfflineChannel",
        "BothChannels"
      ]
    },
    "CreateReferent": {
      "type": "object",
      "required": [
        "firstName",
        "lastName",
        "emailAddress",
        "telephoneNumber"
      ],
      "properties": {
        "firstName": {
          "type": "string"
        },
        "lastName": {
          "type": "string"
        },
        "emailAddress": {
          "type": "string",
          "format": "email"
        },
        "telephoneNumber": {
          "type": "string",
          "maxLength": 15
        }
      }
    },
    "UpdateReferent": {
      "type": "object",
      "required": [
        "firstName",
        "lastName",
        "emailAddress",
        "telephoneNumber"
      ],
      "properties": {
        "firstName": {
          "type": "string"
        },
        "lastName": {
          "type": "string"
        },
        "emailAddress": {
          "type": "string",
          "format": "email"
        },
        "telephoneNumber": {
          "type": "string",
          "maxLength": 15
        }
      }
    },
    "CreateDiscount": {
      "type": "object",
      "required": [
        "name",
        "startDate",
        "endDate",
        "discount",
        "productCategories"
      ],
      "properties": {
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "startDate": {
          "type": "string",
          "format": "date"
        },
        "endDate": {
          "type": "string",
          "format": "date"
        },
        "discount": {
          "type": "number",
          "format": "double",
          "minimum": 0,
          "maximum": 100
        },
        "productCategories": {
          "type": "array",
          "items": {
            "type": "string",
            "minItems": 1
          }
        },
        "condition": {
          "type": "string"
        },
        "staticCode": {
          "type": "string"
        }
      }
    },
    "UpdateDiscount": {
      "type": "object",
      "required": [
        "name",
        "description",
        "startDate",
        "endDate",
        "discount",
        "productCategories",
        "condition"
      ],
      "properties": {
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "startDate": {
          "type": "string",
          "format": "date"
        },
        "endDate": {
          "type": "string",
          "format": "date"
        },
        "discount": {
          "type": "number",
          "format": "double",
          "minimum": 0,
          "maximum": 100
        },
        "productCategories": {
          "type": "array",
          "items": {
            "type": "string",
            "minItems": 1
          }
        },
        "condition": {
          "type": "string"
        },
        "staticCode": {
          "type": "string"
        }
      }
    },
    "Discounts": {
      "type": "object",
      "required": [
        "items"
      ],
      "properties": {
        "items": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Discount"
          }
        }
      }
    },
    "Discount": {
      "type": "object",
      "required": [
        "id",
        "agreementId",
        "state",
        "name",
        "description",
        "startDate",
        "endDate",
        "discount",
        "productCategories",
        "condition"
      ],
      "properties": {
        "id": {
          "type": "string"
        },
        "agreementId": {
          "type": "string"
        },
        "state": {
          "$ref": "#/definitions/DiscountState"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "startDate": {
          "type": "string",
          "format": "date"
        },
        "endDate": {
          "type": "string",
          "format": "date"
        },
        "discount": {
          "type": "number",
          "format": "double",
          "minimum": 0,
          "maximum": 100
        },
        "productCategories": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1
        },
        "condition": {
          "type": "string"
        },
        "staticCode": {
          "type": "string"
        }
      }
    },
    "DiscountState": {
      "type": "string",
      "enum": [
        "draft",
        "published",
        "rejected"
      ]
    },
    "Address": {
      "type": "object",
      "required": [
        "street",
        "zipCode",
        "city",
        "district"
      ],
      "properties": {
        "street": {
          "type": "string"
        },
        "zipCode": {
          "type": "string"
        },
        "city": {
          "type": "string"
        },
        "district": {
          "type": "string"
        }
      }
    }
  },
  "responses": {
    "InvalidRequest": {
      "description": "Bad request"
    },
    "Forbidden": {
      "description": "Forbidden"
    },
    "NotFound": {
      "description": "Not found"
    }
  }
}
